import { Logger } from "@shared/domain/logger";
import { Transaction } from "@transactions/domain/transaction";
import { TransactionRepositoryPort } from "@transactions/domain/transaction-repository-port";

export class TransactionService {
  constructor(
    private readonly transactionRepository: TransactionRepositoryPort,
    private readonly logger: Logger
  ) {}

  async saveTransaction(transaction: Transaction): Promise<void> {
    this.logger.info(
      `[Transaction Service] - Saving transaction for user: ${transaction.userId} with amount: ${transaction.amount}`
    );

    await this.transactionRepository.save(transaction);
    
    this.logger.info("[Transaction Service] - Transaction saved successfully");
  }

  async getTransactionsByUserId(userId: string): Promise<Transaction[]> {
    this.logger.info(
      `[Transaction Service] - Getting transactions for user: ${userId}`
    );

    const transactions = await this.transactionRepository.findByUserId(userId);

    this.logger.info(
      `[Transaction Service] - Found ${transactions.length} transactions for user: ${userId}`
    );

    return transactions;
  }

  async getTransactionsByDateRange(
    userId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Transaction[]> {
    this.logger.info(
      `[Transaction Service] - Getting transactions for user: ${userId} between dates: ${startDate} and ${endDate}`
    );

    const transactions = await this.transactionRepository.findByDateRange(
      userId,
      startDate,
      endDate
    );

    this.logger.info(
      `[Transaction Service] - Found ${transactions.length} transactions for user: ${userId} between dates: ${startDate} and ${endDate}`
    );

    return transactions;
  }
}
